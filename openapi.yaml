openapi: 3.0.3
info:
  title: Business Cards API
  version: "v1"
  description: >
    REST API для мобильного приложения хранения визиток.
    Модели: users, companies, company_addresses, company_websites,
    business_cards, card_channels, card_images, tags, card_tags.

servers:
  - url: https://api.example.com

paths:
  /api/v1/auth/register:
    post:
      summary: Регистрация пользователя
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: Created

  /api/v1/auth/login:
    post:
      summary: Авторизация (возвращает JWT)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                  token_type:
                    type: string
                  expires_in:
                    type: integer

  /api/v1/users/me:
    get:
      summary: Текущий пользователь
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /api/v1/companies:
    get:
      summary: Список компаний
      parameters:
        - name: search
          in: query
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
        - name: per_page
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: OK
    post:
      summary: Создать компанию (включая адреса/сайты)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompanyCreate'
      responses:
        '201':
          description: Created

  /api/v1/companies/{company_id}:
    parameters:
      - name: company_id
        in: path
        required: true
        schema:
          type: integer
    get:
      summary: Получить компанию
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Company'
    put:
      summary: Обновить компанию
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompanyUpdate'
      responses:
        '200':
          description: Updated
    delete:
      summary: Удалить компанию
      security:
        - bearerAuth: []
      responses:
        '204':
          description: No Content

  /api/v1/companies/{company_id}/addresses:
    post:
      summary: Добавить адрес компании
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompanyAddressCreate'
      responses:
        '201':
          description: Created

  /api/v1/companies/{company_id}/websites:
    post:
      summary: Добавить сайт компании
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompanyWebsiteCreate'
      responses:
        '201':
          description: Created

  /api/v1/cards:
    get:
      summary: Список визиток (фильтры: card_type, tag, is_favorite, status)
      parameters:
        - name: card_type
          in: query
          schema:
            type: string
        - name: tag
          in: query
          schema:
            type: string
        - name: is_favorite
          in: query
          schema:
            type: boolean
        - name: status
          in: query
          schema:
            type: string
        - name: page
          in: query
          schema:
            type: integer
        - name: per_page
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CardListResponse'
    post:
      summary: Создать визитку (включая channels/tags/images)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CardCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Card'

  /api/v1/cards/{card_id}:
    parameters:
      - name: card_id
        in: path
        required: true
        schema:
          type: integer

    get:
      summary: Получить визитку
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Card'

    put:
      summary: Обновить визитку (замена)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CardUpdate'
      responses:
        '200':
          description: Updated

    delete:
      summary: Удалить визитку (soft delete)
      security:
        - bearerAuth: []
      responses:
        '204':
          description: No Content

  /api/v1/cards/{card_id}/channels:
    post:
      summary: Добавить контакт (card_channels)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CardChannelCreate'
      responses:
        '201':
          description: Created

  /api/v1/cards/{card_id}/images:
    post:
      summary: Добавить изображение карточки (card_images)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CardImageCreate'
      responses:
        '201':
          description: Created

  /api/v1/tags:
    get:
      summary: Список тегов пользователя
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
    post:
      summary: Создать тег
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TagCreate'
      responses:
        '201':
          description: Created

  /api/v1/cards/{card_id}/tags:
    post:
      summary: Прикрепить тег к карточке (card_tags)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                tag_id:
                  type: integer
      responses:
        '201':
          description: Created

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
        first_name:
          type: string
        last_name:
          type: string
        patronymic:
          type: string
          nullable: true
        email:
          type: string
        avatar_url:
          type: string
          nullable: true
        is_active:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    RegisterRequest:
      type: object
      required:
        - first_name
        - last_name
        - email
        - password
      properties:
        first_name:
          type: string
        last_name:
          type: string
        patronymic:
          type: string
          nullable: true
        email:
          type: string
          format: email
        password:
          type: string

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
        password:
          type: string

    Company:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        industry:
          type: string
        logo_url:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        addresses:
          type: array
          items:
            $ref: '#/components/schemas/CompanyAddress'
        websites:
          type: array
          items:
            $ref: '#/components/schemas/CompanyWebsite'

    CompanyCreate:
      type: object
      required:
        - name
      properties:
        name:
          type: string
        industry:
          type: string
        logo_url:
          type: string
        addresses:
          type: array
          items:
            $ref: '#/components/schemas/CompanyAddressCreate'
        websites:
          type: array
          items:
            $ref: '#/components/schemas/CompanyWebsiteCreate'

    CompanyUpdate:
      type: object
      properties:
        name:
          type: string
        industry:
          type: string
        logo_url:
          type: string

    CompanyAddress:
      type: object
      properties:
        id:
          type: integer
        company_id:
          type: integer
        street:
          type: string
        house:
          type: string
        postal_code:
          type: string
        city:
          type: string
        is_main_address:
          type: boolean
        created_at:
          type: string
          format: date-time

    CompanyAddressCreate:
      type: object
      required:
        - street
        - house
        - city
      properties:
        street:
          type: string
        house:
          type: string
        postal_code:
          type: string
        city:
          type: string
        is_main_address:
          type: boolean

    CompanyWebsite:
      type: object
      properties:
        id:
          type: integer
        company_id:
          type: integer
        url:
          type: string
        is_main_site:
          type: boolean
        created_at:
          type: string
          format: date-time

    CompanyWebsiteCreate:
      type: object
      required:
        - url
      properties:
        url:
          type: string
        is_main_site:
          type: boolean

    Card:
      type: object
      properties:
        id:
          type: integer
        user_id:
          type: integer
        card_type:
          type: string
        company_id:
          type: integer
          nullable: true
        person_first_name:
          type: string
        person_last_name:
          type: string
        person_patronymic:
          type: string
          nullable: true
        position:
          type: string
          nullable: true
        status:
          type: string
        is_favorite:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        channels:
          type: array
          items:
            $ref: '#/components/schemas/CardChannel'
        images:
          type: array
          items:
            $ref: '#/components/schemas/CardImage'
        tags:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
              name:
                type: string

CardCreate:
  type: object
  required:
    - card_type
  properties:
    card_type:
      type: string
      enum:
        - company
        - personal
    company_id:
      type: integer
      nullable: true
    person_first_name:
      type: string
    person_last_name:
      type: string
    person_patronymic:
      type: string
      nullable: true
    position:
      type: string
      nullable: true
    is_favorite:
      type: boolean
    channels:
      type: array
      items:
        $ref: '#/components/schemas/CardChannelCreate'
    images:
      type: array
      items:
        $ref: '#/components/schemas/CardImageCreate'
    tags:
      type: array
      items:
        type: string


    CardUpdate:
      type: object
      properties:
        person_first_name:
          type: string
        person_last_name:
          type: string
        person_patronymic:
          type: string
        position:
          type: string
        is_favorite:
          type: boolean
        status:
          type: string

    CardListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Card'
        meta:
          type: object
          properties:
            page:
              type: integer
            per_page:
              type: integer
            total:
              type: integer

    CardChannel:
      type: object
      properties:
        id:
          type: integer
        card_id:
          type: integer
        channel_type:
          type: string
        value:
          type: string
        label:
          type: string
        is_primary:
          type: boolean
        created_at:
          type: string
          format: date-time

    CardChannelCreate:
      type: object
      required:
        - channel_type
        - value
      properties:
        channel_type:
          type: string
        value:
          type: string
        label:
          type: string
        is_primary:
          type: boolean

    CardImage:
      type: object
      properties:
        id:
          type: integer
        card_id:
          type: integer
        image_url:
          type: string
        side:
          type: string
          enum:
            - front
            - back
        created_at:
          type: string
          format: date-time

    CardImageCreate:
      type: object
      required:
        - image_url
      properties:
        image_url:
          type: string
        side:
          type: string
          enum:
            - front
            - back

    Tag:
      type: object
      properties:
        id:
          type: integer
        user_id:
          type: integer
        name:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    TagCreate:
      type: object
      required:
        - name
      properties:
        name:
          type: string
